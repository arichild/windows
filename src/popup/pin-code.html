<div class="ui-popup pin-code">
  <div class="ui-popup-head">Регистрация Исполнителя</div>

  <div class="ui-popup-body">
    <div class="pin-code-subtitle">В течение 5 минут вы получите смс с кодом подтверждения. Введите его ниже:</div>

    <form action="#" class="popup-form">
      <div class="ui-field">
        <label class="ui-label" for="pin">Код из СМС <span>*</span></label>

        <div class="ui-pin">
          <input type="text" maxlength="1">
          <input type="text" maxlength="1">
          <input type="text" maxlength="1">
          <div class="space"></div>
          <input type="text" maxlength="1">
          <input type="text" maxlength="1">
          <input type="text" maxlength="1" id="pin">
        </div>
        <span class="pin-error hidden">Пожалуйста, заполните поля</span>
      </div>

      <div class="pin-code-link">Не получили SMS? <a href="#">Отправить повторно</a></div>

      <button class="ui-btn">Завершить регистрацию</button>

      <div class="pin-code-desc">Не бойтесь, мы будетм надёжно хранить его и не покажем его никому, кроме Заказчиков, принявших решение работать с вами.</div>
    </form>
  </div>

  <script>
    $( document ).ready(function() {
      const inputs = document.querySelectorAll(".ui-pin input");
      const values = []

      inputs.forEach((input, index) => {
        input.addEventListener('input', () => {
          const {value, maxLength} = input;

          if (value.length === 0 && index > 0) {
            values.splice(index - 1, 1);
            inputs[index - 1].focus();
          } else if (index < inputs.length - 1 && value.length === maxLength) {
            values[index] = value;
            inputs[index + 1].focus();
          } else {
            values[index] = value;
          }
        });

        input.addEventListener('keydown', (e) => {
          const {value, maxLength} = input;

          if (e.key === 'Backspace' && value.length === 0 && index > 0) {
            values.splice(index - 1, 1);
            inputs[index - 1].focus();
          } else if (e.key !== 'Backspace' && value.length === maxLength && index < inputs.length - 1) {
            values[index] = value;
            inputs[index + 1].focus();
          } else {
            values[index] = value;
          }
        });
      });

      $(".popup-form").validate({
        errorElement: "span",

        submitHandler: function (form) {
          const err = document.querySelector('.pin-error')

          if(values.length === 6) {
            const output = values.join('')
            err.classList.add('hidden')

            showPopup('./popup/success.html')
          } else {
            err.classList.remove('hidden')
          }
        },
      });
    });
  </script>
</div>